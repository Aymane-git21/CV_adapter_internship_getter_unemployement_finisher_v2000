% We use 'standalone' to crop the page to the content height.
\documentclass[10pt, border=1.2cm]{standalone}

% --- Language & Encoding ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}

% --- Typography ---
\usepackage[default]{sourcesanspro}
\usepackage{microtype}

% --- Graphics & Colors ---
\usepackage[dvipsnames,svgnames]{xcolor}
\usepackage{tikz}
\usepackage{tcolorbox}
\usepackage{fontawesome5}
\usepackage{graphicx}
\usetikzlibrary{calc, shadows, positioning}

% --- Layout Utilities ---
\usepackage{geometry}
\usepackage{parskip} 
\usepackage{setspace}
\usepackage{hyperref}

% ============================================================
%                      THEME CONFIGURATION
% ============================================================

\definecolor{primary}{RGB}{12, 36, 60}      % Deep Midnight Blue
\definecolor{accent}{RGB}{0, 160, 220}      % Bright Electric Cyan
\definecolor{textgray}{RGB}{60, 60, 60}     % Softer text color

\hypersetup{
    colorlinks=true,
    linkcolor=primary,
    urlcolor=primary,
    pdfborder={0 0 0}
}

% ============================================================
%                      USER DATA
% ============================================================
\newcommand{\YourName}{Aymane Merbouh}
\newcommand{\YourTitle}{Master 2 | IA\&RA, Réalité Mixte (AR/VR)}
\newcommand{\YourPhone}{+33 6 60 68 67 20}
\newcommand{\YourEmail}{aymanemerbouh03@gmail.com}
\newcommand{\YourLinkedIn}{https://www.linkedin.com/in/aymane-merbouh-870b07237/}
\newcommand{\YourGithub}{github.com/Aymane-git21}
\newcommand{\YourCity}{Valenciennes / Paris}
\newcommand{\YourPortfolio}{aymanemerbouh.com} 

% ============================================================
%                      CUSTOM COMMANDS
% ============================================================

\newcommand{\makeextraheader}{
    \noindent % <--- CRITICAL: Prevents indentation shifting the box
    \begin{tikzpicture}
        \node [
            rectangle, 
            shading=axis,
            left color=primary,
            right color=primary!95!black,
            % FIX: 18.6cm total - (2 * 20pt padding) = ~17.2cm text width
            text width=17.1cm, 
            inner sep=20pt,
            rounded corners=8pt,
            align=center
        ] (banner) at (0,0) {
            % -- Left Side (Name/Title) 55% width --
            \begin{minipage}[c]{0.55\textwidth}
                {\color{white}\Huge\bfseries\MakeUppercase{\YourName}}\\[6pt]
                {\color{accent}\Large\bfseries \YourTitle}
                
                \vspace{12pt} 
                
                % -- PORTFOLIO BUTTON --
                \href{https://\YourPortfolio}{%
                    \tikz{
                        \node[
                            fill=white,
                            text=primary,
                            rounded corners=4pt,
                            inner xsep=10pt,
                            inner ysep=6pt,
                            font=\bfseries\small,
                            drop shadow={opacity=0.3}
                        ] {\faGlobe \ \ See My Portfolio \ \faArrowRight};
                    }%
                }
            \end{minipage}%
            \hfill
            % -- Right Side (Contact) 40% width --
            % Increased width to fit long email
            \begin{minipage}[c]{0.42\textwidth}
                \raggedleft
                \color{white}
                \small % Slightly larger than footnotesize for readability
                \faMapMarker* \ \YourCity \\
                \vspace{5pt}
                \faPhone \ \YourPhone \\
                \vspace{5pt}
                \href{mailto:\YourEmail}{\color{white}\faEnvelope \ \YourEmail} \\
                \vspace{5pt}
                \href{https://\YourLinkedIn}{\color{accent!30!white}\faLinkedin \ LinkedIn}
                \quad
                \href{https://\YourGithub}{\color{accent!30!white}\faGithub \ GitHub}
            \end{minipage}
        };
    \end{tikzpicture}
    \vspace{0.5cm}
}

\newcommand{\recipientblock}[3]{
    \noindent
    \begin{minipage}[t]{0.5\textwidth}
        \textbf{\large #1} \\ 
        \textcolor{textgray}{#2} \\ 
        \textcolor{textgray}{#3}   
    \end{minipage}%
    \hfill
    \begin{minipage}[t]{0.4\textwidth}
        \raggedleft
        \textbf{\today} \\
        \textit{\YourCity}
    \end{minipage}
    \vspace{0.8cm}
}

% Redefine subject to avoid double "Objet :" since app.py sends it
\renewcommand{\subject}[1]{
    {
        \color{primary}\bfseries 
        \begin{tikzpicture}[baseline={([yshift=-.6ex]current bounding box.center)}]
            \fill[accent] (0,0) circle (2.5pt);
        \end{tikzpicture}
        \ #1
    }
    \vspace{0.5cm}
}

\renewcommand{\baselinestretch}{1.2} 
\newcommand{\bodytext}[1]{
    \color{textgray}
    #1
}

% Compatibility definitions for app.py
\newcommand{\opening}[1]{
    \noindent \textbf{#1}
    \vspace{0.5cm}
}

\newcommand{\closing}[1]{
    \vspace{1.5cm}
    \noindent
    \begin{minipage}{0.5\textwidth}
        \textcolor{primary}{\textbf{#1}}\\[0.5cm]
        \textbf{\YourName}
    \end{minipage}
}

\newcommand{\makesignature}{
    \vspace{1.5cm}
    \noindent
    \begin{minipage}{0.5\textwidth}
        \textcolor{primary}{\textbf{Cordialement,}}\\[0.5cm]
        \textbf{\YourName}
    \end{minipage}
}

% ============================================================
%                      DOCUMENT CONTENT
% ============================================================
\begin{document}
\centering
\noindent
\begin{minipage}{18.6cm}

\makeextraheader

\recipientblock
    {Nom de l'Entreprise}
    {À l'attention du Responsable Recrutement}
    {Adresse de l'entreprise}


\subject{\textbf{Objet :} Candidature Test Simulé}

\opening{Madame, Monsieur,}

Ceci est un test pour vérifier que le contenu généré par l'app (qui utilise opening et closing) s'affiche correctement et qu'il n'y a plus de duplication.

\lipsum[1-2]

\closing{Cordialement,}


\end{minipage}
\end{document}